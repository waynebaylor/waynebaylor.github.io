import{l as e,c as t,C as i,F as s,p as n,r as l}from"./vendor.9a0711d1.js";async function a(t,i){const s="infinite-scroll-"+t;if(!(await e.keys()).includes(s)){const n=await fetch(`https://chroniclingamerica.loc.gov/search/titles/results/?terms=colorado&format=json&rows=${i}&page=${t}`);if(n.status>400)throw new Error(`API Error. Status code: ${n.status}`);const l=await n.json();await e.setItem(s,l)}return await e.getItem(s)}function o(){return t("header",null,t("h1",null,"Advanced Infinite Scroll"),t("div",null,t("button",{type:"button",class:"btn btn-error",title:"Clear cached data",onclick:async()=>{this.dispatchEvent(new CustomEvent("clear-cache",{bubbles:!0}))}},"Clear Cache")))}function*r(e){const s=new IntersectionObserver((e=>{e[0].isIntersecting&&this.dispatchEvent(new CustomEvent("bottom-visible",{bubbles:!0}))}),{root:null,rootMargin:"920px",threshold:1});this.schedule((e=>{requestAnimationFrame((()=>{s.observe(e)}))})),yield t("div",null);try{for({}of this)yield t(i,null)}finally{s.disconnect()}}function*c(e){const s=new IntersectionObserver((e=>{this.dispatchEvent(new CustomEvent("page-bottom-visibility",{bubbles:!0,detail:{visible:e[0].isIntersecting}}))}),{root:null,rootMargin:"0px",threshold:1});this.schedule((e=>{requestAnimationFrame((()=>{s.observe(e)}))})),yield t("div",null);try{for({}of this)yield t(i,null)}finally{s.disconnect()}}function*d(e){const s=new IntersectionObserver((e=>{this.dispatchEvent(new CustomEvent("page-top-visibility",{bubbles:!0,detail:{visible:e[0].isIntersecting}}))}),{root:null,rootMargin:"0px",threshold:1});this.schedule((e=>{requestAnimationFrame((()=>{s.observe(e)}))})),yield t("div",{class:"page-top-sentinal"});try{for({}of this)yield t(i,null)}finally{s.disconnect()}}function*u(e){let i=e.pageNumber,n=!0,l=!0;const a=()=>{n||l?this.dispatchEvent(new CustomEvent("page-visibility",{bubbles:!0,detail:{pageNumber:i,visible:!0}})):n||l||this.dispatchEvent(new CustomEvent("page-visibility",{bubbles:!0,detail:{pageNumber:i,visible:!1}}))};this.addEventListener("page-top-visibility",(e=>{n=e.detail.visible,a()})),this.addEventListener("page-bottom-visibility",(e=>{l=e.detail.visible,a()}));for(const o of this){const{pageSize:e,items:n}=o;if(i=o.pageNumber,0===n.length){const i=[];for(let s=0;s<e;s++)i.push(t("div",{"crank-key":s,class:"tile tombstone"}));yield t(s,null,t(d,null),i,t(c,null))}else yield t(s,null,t(d,null),n.map(((e,i)=>t("div",{"crank-key":i,class:"tile"},t("div",{class:"tile-icon"},t("i",{class:"far fa-newspaper fa-2x"})),t("div",{class:"tile-content"},t("a",{href:e.url.replace(".json",""),class:"tile-title"},e.title),t("span",{class:"date-range"},e.start_year," â€“ ",e.end_year),t("div",{class:"tile-subtitle"},t("strong",null,"Publisher:")," ",e.publisher,t("br",null),t("strong",null,"Place of publication:")," ",e.place_of_publication))))),t(c,null))}}function*h(e){for(const{data:i,pageSize:s}of this)yield t("div",{class:"listing"},t("h2",null,"US Newspaper Directory: Colorado"),t("p",{class:"subtitle"},t("em",null,"Data provided by ",t("a",{href:"https://chroniclingamerica.loc.gov"},"https://chroniclingamerica.loc.gov"))),Array.from(i,(([e,i])=>t(u,{"crank-key":e,pageSize:s,pageNumber:e,items:i}))),t(r,null))}async function*b(i){const n=new Map,l=new Map;let c;for await({}of(this.addEventListener("clear-cache",(async()=>{await async function(){await e.clear()}(),n.clear(),l.clear(),this.refresh()})),this.addEventListener("bottom-visible",(async()=>{const e=Math.max(0,...l.keys())+1,t=await a(e,10);l.set(e,t.items),this.refresh()})),this.addEventListener("page-visibility",(async e=>{const{pageNumber:t,visible:i}=e.detail;n.set(t,i),isNaN(c)||clearTimeout(c),c=setTimeout((async()=>{for(const[e,t]of n)if(t){const t=await a(e,10);l.set(e,t.items)}else l.set(e,[]);this.refresh()}),100)})),this))yield t("div",{class:"container grid-lg"},t(o,null),0===l.size&&t(s,null,t(r,null)," ",t("div",{class:"hero"},t("h1",{class:"text-center text-gray"},"Loading..."),t("div",{class:"loading loading-lg"}))),l.size>0&&t(h,{data:l,pageSize:10}))}n.base("/crank-examples/advanced-infinite-scroll"),n("*",(()=>{document.title="Advanced Infinite Scroll",l.render(t(b,null),document.getElementById("app"))})),n();
